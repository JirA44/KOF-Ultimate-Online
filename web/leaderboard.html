<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classement - KOF Ultimate Online</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .leaderboard-container {
            background: rgba(30, 58, 138, 0.3);
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 16px;
            padding: 30px;
            margin: 40px 0;
        }

        .leaderboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .leaderboard-header h3 {
            color: var(--primary);
            font-size: 2em;
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
        }

        .filter-tab {
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-tab:hover,
        .filter-tab.active {
            background: var(--primary);
            color: var(--background);
            border-color: var(--primary);
        }

        .leaderboard-table-full {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table-full thead tr {
            background: rgba(0, 212, 255, 0.2);
        }

        .leaderboard-table-full th {
            padding: 15px;
            text-align: left;
            color: var(--primary);
            font-weight: bold;
            border-bottom: 2px solid var(--primary);
        }

        .leaderboard-table-full td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .player-row-full {
            transition: all 0.3s ease;
        }

        .player-row-full:hover {
            background: rgba(0, 212, 255, 0.15);
            transform: scale(1.01);
        }

        .rank-cell {
            font-weight: bold;
            font-size: 1.3em;
            width: 80px;
        }

        .rank-1 .rank-cell { color: #ffd700; }
        .rank-2 .rank-cell { color: #c0c0c0; }
        .rank-3 .rank-cell { color: #cd7f32; }

        .username-cell {
            color: var(--text);
            font-weight: 600;
            font-size: 1.1em;
        }

        .elo-cell {
            color: var(--primary);
            font-weight: bold;
            font-size: 1.2em;
        }

        .wl-cell {
            color: var(--text-secondary);
        }

        .winrate-cell {
            color: var(--success);
            font-weight: bold;
        }

        .status-cell {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .player-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .player-status.online {
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
        }

        .player-status.offline {
            background: #666;
        }

        .elo-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .elo-badge.diamond { background: #b9f2ff; color: #0a0e27; }
        .elo-badge.platinum { background: #00e5ff; color: #0a0e27; }
        .elo-badge.gold { background: #ffd700; color: #0a0e27; }
        .elo-badge.silver { background: #c0c0c0; color: #0a0e27; }
        .elo-badge.bronze { background: #cd7f32; color: #0a0e27; }

        .search-box {
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: var(--text);
            font-size: 1em;
            width: 300px;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
        }

        .podium {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
            margin: 40px 0;
            height: 300px;
        }

        .podium-place {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
        }

        .podium-player {
            background: rgba(30, 58, 138, 0.5);
            border: 2px solid;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            width: 200px;
            margin-bottom: 10px;
        }

        .podium-place.first .podium-player {
            border-color: #ffd700;
        }

        .podium-place.second .podium-player {
            border-color: #c0c0c0;
        }

        .podium-place.third .podium-player {
            border-color: #cd7f32;
        }

        .podium-medal {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .podium-username {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .podium-elo {
            font-size: 1.5em;
            font-weight: bold;
        }

        .podium-pedestal {
            background: linear-gradient(to top, rgba(0, 212, 255, 0.3), transparent);
            border: 2px solid;
            border-radius: 8px 8px 0 0;
            width: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
        }

        .podium-place.first .podium-pedestal {
            height: 180px;
            border-color: #ffd700;
        }

        .podium-place.second .podium-pedestal {
            height: 140px;
            border-color: #c0c0c0;
        }

        .podium-place.third .podium-pedestal {
            height: 100px;
            border-color: #cd7f32;
        }
    </style>
</head>
<body>
    <div class="background-animation"></div>

    <header class="main-header">
        <div class="container">
            <div class="logo">
                <h1>‚öîÔ∏è KOF ULTIMATE ONLINE ‚öîÔ∏è</h1>
                <p class="tagline">Classement</p>
            </div>
            <nav class="main-nav">
                <a href="index.html">Accueil</a>
                <a href="dashboard.html">Dashboard</a>
                <a href="leaderboard.html" class="active">Classement</a>
                <a href="docs.html">Documentation</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h2 class="hero-title">üèÜ Classement ELO üèÜ</h2>
            <p class="hero-description">
                D√©couvrez les meilleurs joueurs de KOF Ultimate Online
            </p>
        </section>

        <!-- Podium Top 3 -->
        <div class="podium" id="podium">
            <div class="loading">Chargement du podium...</div>
        </div>

        <!-- Classement Complet -->
        <div class="leaderboard-container">
            <div class="leaderboard-header">
                <h3>Classement Complet</h3>
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all">Tous</button>
                    <button class="filter-tab" data-filter="online">En ligne</button>
                    <button class="filter-tab" data-filter="top">Top 50</button>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <input type="text" class="search-box" id="search-input" placeholder="Rechercher un joueur...">
            </div>

            <div id="leaderboard-full">
                <div class="loading">Chargement du classement...</div>
            </div>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>KOF Ultimate Online</h3>
                    <p>Classement mis √† jour en temps r√©el</p>
                </div>
                <div class="footer-section">
                    <h3>L√©gende des Rangs</h3>
                    <div>
                        <div>Diamond: 2500+ ELO</div>
                        <div>Platinum: 2000-2499 ELO</div>
                        <div>Gold: 1500-1999 ELO</div>
                        <div>Silver: 1000-1499 ELO</div>
                        <div>Bronze: 0-999 ELO</div>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 KOF Ultimate Online | Classement v1.0</p>
            </div>
        </div>
    </footer>

    <script src="app.js"></script>
    <script>
        let allPlayers = [];
        let currentFilter = 'all';

        // Charger le classement complet
        async function loadFullLeaderboard() {
            try {
                const response = await fetch(`${API_BASE}/leaderboard`);
                const result = await response.json();

                if (result.success) {
                    allPlayers = result.data;
                    updatePodium(allPlayers.slice(0, 3));
                    displayLeaderboard(allPlayers);
                }
            } catch (error) {
                console.error('Erreur chargement classement:', error);
            }
        }

        // Afficher le podium
        function updatePodium(top3) {
            const podium = document.getElementById('podium');
            if (!top3 || top3.length === 0) {
                podium.innerHTML = '<div class="no-data">Pas encore de donn√©es</div>';
                return;
            }

            const places = [
                { player: top3[1], rank: 2, medal: 'ü•à', class: 'second' },
                { player: top3[0], rank: 1, medal: 'ü•á', class: 'first' },
                { player: top3[2], rank: 3, medal: 'ü•â', class: 'third' }
            ];

            podium.innerHTML = places.map(place => {
                if (!place.player) return '';
                return `
                    <div class="podium-place ${place.class}">
                        <div class="podium-player">
                            <div class="podium-medal">${place.medal}</div>
                            <div class="podium-username">${escapeHtml(place.player.username || 'Unknown')}</div>
                            <div class="podium-elo">${place.player.elo || 1000} ELO</div>
                            <div style="margin-top: 10px; color: var(--text-secondary);">
                                ${place.player.wins || 0}W - ${place.player.losses || 0}L
                            </div>
                        </div>
                        <div class="podium-pedestal">#${place.rank}</div>
                    </div>
                `;
            }).join('');
        }

        // Afficher le classement
        function displayLeaderboard(players) {
            const container = document.getElementById('leaderboard-full');

            if (!players || players.length === 0) {
                container.innerHTML = '<div class="no-data">Aucun joueur dans le classement</div>';
                return;
            }

            container.innerHTML = `
                <table class="leaderboard-table-full">
                    <thead>
                        <tr>
                            <th>Rang</th>
                            <th>Joueur</th>
                            <th>ELO</th>
                            <th>Rang</th>
                            <th>V/D</th>
                            <th>Win Rate</th>
                            <th>Statut</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${players.map((player, index) => `
                            <tr class="player-row-full rank-${index + 1}">
                                <td class="rank-cell">
                                    ${index + 1 <= 3 ? getMedalIcon(index + 1) : `#${index + 1}`}
                                </td>
                                <td class="username-cell">${escapeHtml(player.username || 'Unknown')}</td>
                                <td class="elo-cell">${player.elo || 1000}</td>
                                <td>${getEloBadge(player.elo || 1000)}</td>
                                <td class="wl-cell">${player.wins || 0} / ${player.losses || 0}</td>
                                <td class="winrate-cell">${(player.win_rate || 0).toFixed(1)}%</td>
                                <td class="status-cell">
                                    <span class="player-status ${player.status === 'online' ? 'online' : 'offline'}"></span>
                                    ${player.status === 'online' ? 'En ligne' : 'Hors ligne'}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Badge ELO
        function getEloBadge(elo) {
            if (elo >= 2500) return '<span class="elo-badge diamond">Diamond</span>';
            if (elo >= 2000) return '<span class="elo-badge platinum">Platinum</span>';
            if (elo >= 1500) return '<span class="elo-badge gold">Gold</span>';
            if (elo >= 1000) return '<span class="elo-badge silver">Silver</span>';
            return '<span class="elo-badge bronze">Bronze</span>';
        }

        // Filtres
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                currentFilter = tab.dataset.filter;
                applyFilters();
            });
        });

        // Recherche
        document.getElementById('search-input')?.addEventListener('input', (e) => {
            applyFilters();
        });

        function applyFilters() {
            let filtered = [...allPlayers];

            // Filtre par statut
            if (currentFilter === 'online') {
                filtered = filtered.filter(p => p.status === 'online');
            } else if (currentFilter === 'top') {
                filtered = filtered.slice(0, 50);
            }

            // Filtre par recherche
            const searchTerm = document.getElementById('search-input')?.value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(p =>
                    p.username?.toLowerCase().includes(searchTerm)
                );
            }

            displayLeaderboard(filtered);
        }

        // Chargement initial
        loadFullLeaderboard();
        setInterval(loadFullLeaderboard, 30000); // Refresh toutes les 30s
    </script>
</body>
</html>
